!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ticker={})}(this,(function(e){"use strict";const t=e=>"function"==typeof e,r=(e,r="")=>{if(!t(e))throw new TypeError(`${r} Expecting function arg`.trim())},n=e=>t(e.subscribe),i=(e=void 0,n=null)=>{const i=e=>t(n?.persist)&&n.persist(e);let s=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),r=(e,r)=>{if("function"!=typeof r)throw new TypeError("Expecting callback function as second argument");return t(e).add(r),()=>t(e).delete(r)};return{publish:(e,r)=>{t(e).forEach((e=>e(r)))},subscribe:r,subscribeOnce:(e,t)=>{const n=r(e,(e=>{t(e),n()}));return n},unsubscribeAll:t=>e.delete(t)}})(),o=e;i(o);const c=()=>o,u=e=>{o!==e&&(o=e,i(o),s.publish("change",o))};return{set:u,get:c,update:e=>{r(e,"[update]"),u(e(c()))},subscribe:e=>(r(e,"[subscribe]"),e(o),s.subscribe("change",e))}},s=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e;e.createSelectionStore=(e,o=[],c=!1)=>{const u=e=>{if(!Array.isArray(e)||!e.every(s))throw new TypeError("Expecting array of initial item objects");return e};if(!Array.isArray(o)||!o.every((t=>!isNaN(t)&&void 0!==e[t])))throw new TypeError("Expecting array of initial selected indexes");const a=i(u(e)),f=i(o),p=e=>[...new Set(e)],d=((e,s,o=null)=>{const c=e=>t(o?.persist)&&o.persist(e),u=i(o?.initialValue),a=[];if(e.forEach((e=>{if(!n(e))throw new TypeError("Expecting array of StoreLike objects");e.subscribe((e=>a.push(e)))()})),!t(s))throw new TypeError("Expecting second argument to be the derivative function");if(!s.length||s.length>2)throw new TypeError("Expecting the derivative function to have exactly 1 or 2 arguments");let f=0,p=[];return{get:u.get,subscribe:t=>{r(t,"[derived.subscribe]"),f++||e.forEach(((e,t)=>{p.push(e.subscribe((e=>{a[t]=e,1===s.length?(u.set(s(a)),c(u.get())):s(a,(e=>{u.set(e),c(u.get())}))})))}));const n=u.subscribe(t);return()=>{--f||(p.forEach((e=>e())),p=[]),n()}}}})([a,f],(([e,t])=>({items:e,selected:t,selection:t.map((t=>e[t]))}))),l=e=>{if("number"!=typeof e)throw new TypeError("Expecting numeric index");const t=a.get();return t.length&&void 0!==t[e]?[e]:[]},b=(e,t)=>{if(!e.length)return t?f.set([]):void 0;if(!c)return((e,t)=>{const r=l(e);f.update((e=>!c||t?r:p([...e,...r])))})(e[e.length-1],t);const r=e.reduce(((e,t)=>[...e,...l(t)]),[]);f.update((e=>p(t?r:[...e,...r])))},g={subscribe:d.subscribe,get:d.get,select:(e,t=!0)=>{let r=Array.isArray(e)?e:[e];t&&f.set([]);let n=[];return r.forEach((e=>{"number"!=typeof e&&(e=a.get().findIndex((t=>t===e))),e>=0&&n.push(e)})),b(n,!1),g},unselect:e=>{if(void 0===e)return f.set([]),g;const t=f.get();if(!t.length)return g;let r=Array.isArray(e)?e:[e],n=t.reduce(((e,t)=>({...e,[t]:!0})),{});return r.forEach((e=>{"number"!=typeof e&&(e=a.get().findIndex((t=>t===e))),delete n[e]})),b(Object.keys(n).map((e=>parseInt(e))),!0),g},findIndexBy:(e,t)=>((e,t,r)=>r.findIndex((r=>r&&void 0!==r[e]&&r[e]===t)))(e,t,a.get()),reset:(e=[])=>(f.set([]),a.set(u(e||[])),g)};return g}}));
